//- V1.8
html 
  head
    title download pdf
    script(src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous")
    script(src="https://unpkg.com/jspdf-autotable@3.1.0/dist/jspdf.plugin.autotable.js")
    script.
      var imgData = "#{imgData}";
      c = [0,0];
      Pfirma = "#{profile.firma}";
      Pnaam = "#{profile.naam}";
      Pstraat = "#{profile.straat}";
      PstraatNr = "#{profile.straatNr}";
      Ppostcode = "#{profile.postcode}";
      Pplaats = "#{profile.plaats}";
      PbtwNr = "#{profile.btwNr}";
      Piban = "#{profile.iban}";
      Pbic = "#{profile.bic}";
      firma = "#{contact.firma}";
      contactPersoon = "#{contact.contactPersoon}";
      straat = "#{contact.straat}";
      straatNr = "#{contact.straatNr}";
      postcode = "#{contact.postcode}";
      plaats = "#{contact.plaats}";
      btwNr = "#{contact.btwNr}";
      factuurNr = "#{factuur.factuurNr}";
      datum = "#{factuur.datum}";
      var btw = Number(#{btw});
      voorschot = Number(#{factuur.voorschot});
      factuurtext = [];
      factuurtext.push("#{factuurtext[0]}");
      factuurtext.push("#{factuurtext[1]}");
      factuurtext.push("#{factuurtext[2]}");
      factuurtext.push("#{factuurtext[3]}");
      factuurtext.push("#{factuurtext[4]}");
      factuurtext.push("#{factuurtext[5]}");
      var doc = new jsPDF();
      doc.setFont(doc.getFontList()[0]);
      doc.setProperties({
        title: '#{profile.firma} invoice #{factuur.factuurNr}',
        subject: 'Invoice from #{profile.firma}',
        author: '#{profile.firma}',
        keywords: '#{profile.firma} ,Invoice ,#{factuur.factuurNr}',
        creator: '#{profile.firma} Invoice-administrating-system',
      });
      /**HEADER**/
      doc.addImage(imgData, 'JPEG', 15, 5, 50, 50);
      doc.setFontType("bold");
      doc.setFontSize(36);
      doc.setTextColor(170, 170, 170);
      doc.text(140,35,"Invoice");

      /**bedrijfgegevens**/
      doc.setTextColor(0,0,0);
      doc.setFontSize(12);
      doc.setFontType("courier");
      c = [20,60];
      doc.text(c[0],c[1],Pnaam);

      doc.setFontType("bold");
      c[1] += 10;
      doc.text(c[0],c[1],"Business information ");
      doc.setFontType("courier");
      c[1] += 5;
      doc.text(c[0],c[1],Pnaam);
      c[1] += 5;
      doc.text(c[0],c[1],Pstraat + " " + PstraatNr);
      c[1] += 5;
      doc.text(c[0],c[1],"VAT nr: "+ PbtwNr);

      doc.setFontType("bold");
      c[1] += 10;
      doc.text(c[0],c[1],"Bank information");
      doc.setFontType("courier");
      c[1] += 5;
      doc.text(c[0],c[1],"IBAN: "+Piban);
      c[1] += 5;
      doc.text(c[0],c[1],"BIC: "+Pbic);

      /**factuur info**/
      doc.setFontType("bold");
      c = [120,60];
      doc.text(c[0],c[1],"Invoice date:");
      c[1] +=5;
      doc.text(c[0],c[1],"Invoice nr:");
      doc.setFontType("courier");
      c[0] += 30;
      c[1] -= 5;
      doc.text(c[0],c[1],datum);
      c[1] += 5;
      doc.text(c[0],c[1],factuurNr);

      /**factuur gegevens**/
      c = [120,75];
      doc.setFontType("bold");
      doc.text(c[0],c[1],"Invoice information");
      c[1] +=5;
      doc.setFontType("courier");
      if(firma){
        doc.text(c[0],c[1],firma);
        c[1] +=5;
      }
      doc.text(c[0],c[1],contactPersoon);
      c[1] +=5;
      doc.text(c[0],c[1],straat+" "+straatNr);
      c[1] +=5;
      if(plaats){
        if(postcode){
          doc.text(c[0],c[1],postcode+" "+plaats);
        }else{
          doc.text(c[0],c[1],plaats);
        }
        c[1] +=5;
      }
      if(btwNr){
        doc.text(c[0],c[1],"BTW nr: "+btwNr);

      }
      /**Beschrijvingen**/

      var unusable_json_data = "#{bestellingen}";
      var current = JSON.parse(unusable_json_data.replace(/(&quot\;)/g,"\""));
      var bestellingen = [];
      var aantal = Number(#{lengte});
      var totaalEx = 0;
      var _btw;
      var totaalInc;
      for(var i = 0; i <=aantal-1;i++){
        bestellingen.push([current[i].beschrijving,current[i].aantal,current[i].bedrag,current[i].totaal]);
      }
      for(var i = 0; i <=bestellingen.length-1; i++){
        console.log(bestellingen[i][3]);
        totaalEx +=bestellingen[i][3];
      }

      var bestellingenPrint = [];
      for(var i = 0; i <=aantal-1;i++){
        bestellingenPrint.push([current[i].beschrijving,current[i].aantal,current[i].bedrag.toFixed(2)+" €",current[i].totaal.toFixed(2)+" €"]);
      }

      doc.autoTable({
        theme: 'grid',
        columnStyles: {
          0:{fillColor:[255,255,255]},
          1:{fillColor:[255,255,255],halign:'right'},
          2:{fillColor:[255,255,255],halign:'right'},
          3:{fillColor:[255,255,255],halign:'right'}
          },
        styles: {fillColor: [140, 140, 140]},
        startY: 110,
        head: [['Description', 'Amount', 'Price','Total']],
        body: bestellingenPrint
        });
      _btw = Math.round((totaalEx-voorschot)*btw)/100;
      totaalExSub  = totaalEx - voorschot;
      totaalInc = totaalExSub+_btw;
      if(voorschot==0){

        doc.autoTable({
          theme: 'plain',
          startX: 200,
          columnStyles: {
            0:{fillColor:[255,255,255]},
            1:{fillColor:[255,255,255]},
            2:{fillColor:[255,255,255],halign:'right'},
            3:{fillColor:[180,180,180],halign:'right'}},
          styles: {fillColor: [140, 140, 140]},
          body: [
          [[""],["                               "],["Subtotal"],[totaalEx.toFixed(2)+" €"]],
          [[""],["                               "],["VAT "+btw+"%"],[_btw.toFixed(2)+" €"]],
          [[""],["                               "],["Total amount"],[totaalInc.toFixed(2)+" €"]]
          ]
        })
      }else{
        doc.autoTable({
          theme: 'plain',
          startX: 200,
          columnStyles: {
            0:{fillColor:[255,255,255]},
            1:{fillColor:[255,255,255]},
            2:{fillColor:[255,255,255],halign:'right'},
            3:{fillColor:[140,140,140],halign:'right'}},
          styles: {fillColor: [140, 140, 140]},
          body: [
          [[""],["                               "],["Subtotal"],[totaalEx.toFixed(2)+" €"]],
          [[""],["                               "],["Advance"],["-"+voorschot.toFixed(2)+" €"]],
          [[""],["                               "],["Subtotal"],[totaalExSub.toFixed(2)+" €"]],
          [[""],["                               "],["VAT "+btw+"%"],[_btw.toFixed(2)+" €"]],
          [[""],["                               "],["Total"],[totaalInc.toFixed(2)+" €"]]
          ]
        })
      }
      /**Footer & Disclaimer**/
      doc.setFontType("courier");
      doc.setFontSize(10);
      doc.text(20,265,factuurtext[0]);
      doc.text(20,270,factuurtext[1]);
      doc.text(20,275,factuurtext[2]);
      doc.text(20,280,factuurtext[3]);
      doc.setFontType("bold");
      doc.text(80,285,"We thank you for your trust.");
      /**EINDE FACTUUR GENERATIE**/
      doc.save(factuurNr+'.pdf');
  body
    h1 Close this page after downloading the pdf
