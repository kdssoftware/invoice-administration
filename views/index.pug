html
  head
    include includes/htmlHead
  body(onpageshow='drawChart(['+total+'])')
    header
      include includes/topBar
      div(class="container-fluid")
        div(class ="row")
          nav(class="col-md-2 d-none d-md-block bg-light sidebar")
            div(class="sidebar-sticky")
              include includes/navFlexCollumn
              include includes/bookmarks
    main(role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4")
      div(class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom")
        h1(class="h2") #{__('Dashboard')}
        div(class="btn-group dropleft mb-2 mb-md-0")
            button(type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle", data-toggle="dropdown",aria-haspopup="true",aria-expanded="false")
                span(data-feather="calendar")
                span=year
            div(class="dropdown-menu")
              a(class="dropdown-item" href="/dashboard/chart/"+String(year-2))=year-2
              a(class="dropdown-item" href="/dashboard/chart/" + String(year - 1) )=year - 1
              a(class="dropdown-item active" href="/dashboard/chart/" + year )=year
              a(class="dropdown-item" href="/dashboard/chart/" + String(Number(year) + Number(1)))=String(Number(year) + Number(1))
              a(class="dropdown-item" href="/dashboard/chart/" + String(Number(year) + Number(2)))=String(Number(year) + Number(2))
      canvas(class="my-4 w-100" id="myChart" width="900" height="380")
      h2 #{__('Unpaid invoices')}
      if fact_open.length == 0
          div(class="alert alert-info col-lg-12 col-md-12 col-sm-12" role="alert") #{__('No unpaid invoices found.')}
      else
          div(class="table-responsive bigger")
            table(class="table table-striped table-sm")
              thead(class="thead-dark")
                tr
                  th #{__('Number')}
                  if !client
                    th #{__('Client')}
                  th #{__('Date')}
                  th #{__('Price')}
                  th #{__('Status')}
                  th #{__('Actions')}
              tbody
                each invoice in fact_open
                  tr
                    td
                      if invoice.invoiceNr
                        if client
                          a(href='/order/all/' + invoice._id + "/" )=invoice.invoiceNr
                      if invoice.offerteNr && !invoice.invoiceNr
                        if client
                          a(href='/order/all/' + invoice._id + "/" )="#{__('Invoice')} " + invoice.offerteNr
                      if invoice.creditNr && !invoice.offerteNr && !invoice.invoiceNr
                        a(href='/order/all/' + invoice._id + "/" )="#{__('Creditnote')} " + invoice.creditnr
                    if !client
                      td
                        a(href='/invoice/'  )=invoice.clientName
                    td=invoice.date
                    if invoice.invoiceNr
                      td
                          if invoice.isPaid
                            span=(invoice.total * 1.21).toFixed(2) + "€"
                          if !invoice.isPaid
                            span=(invoice.total * 1.21).toFixed(2) + "€"
                    else
                      td
                    if invoice.invoiceNr
                      td
                        div(class="custom-control custom-switch")
                          if invoice.isPaid
                            input(type="checkbox" class="custom-control-input bg-success" id=invoice._id, onclick='changeBetaald(\"' + invoice._id + '\",\"' + client + '\",\"'  + '\")', checked)
                            label(class="custom-control-label" for=invoice._id)=" #{__('Paid')}"
                          if !invoice.isPaid
                            input(type="checkbox" class="custom-control-input bg-danger" id=invoice._id, onclick='changeBetaald(\"' + invoice._id + '\",\"' + client + '\",\"'  + '\")')
                            label(class="custom-control-label" for=invoice._id)=" #{__('Unpaid')}"
                    else
                      td
                    td
                      div(class="btn-group front")
                        button(role="button", class="btn btn-outline-" + settings.thema + " btn-sm dropdown-toggle", href="#", id="actionsDropdown", data-toggle="dropdown", aria-haspopup="true", aria-expanded="false") #{__('Actions')}
                        div(class="dropdown-menu", aria-labelledby="actionsDropdown")
                          a(class="dropdown-item button", href='/view/invoice/' + invoice._id ) #{__('View')}
                          div(class="dropdown-divider")
                          if invoice.creditNr
                            a(class="dropdown-item", href='/download/creditnote/' + invoice._id ,id="target",target="_blank") #{__('Download creditnote')}
                          if invoice.invoiceNr
                            a(class="dropdown-item", href='/download/invoice/' + invoice._id ,id="target",target="_blank") #{__('Download invoice')}
                          if invoice.offerteNr
                            a(class="dropdown-item", href='/download/offer/' + invoice._id,id="target",target="_blank") #{__('Download offer')}
                            if !invoice.invoiceNr
                              if client
                                a(class="dropdown-item button", href="/opwaardeer/" + invoice._id + "/" ) #{__('Upgrade to invoice')}
                            div(class="dropdown-divider")
                                a(class="dropdown-item",href='/edit-invoice/' + invoice.client + '/' + invoice._id + "/" ) #{__('Edit')}
                                a(class="dropdown-item", href='/delete-invoice/' + invoice.client + '/' + invoice._id + "/" ) #{__('Delete')}


script.
    $(document).ready(function () {
        feather.replace();
    });
    function drawChart(totaal) {
        console.log(totaal);
        var ctx = document.getElementById('myChart').getContext('2d');
        var maand = ["#{__('January')}", "#{__('February')}", "#{__('March')}", "#{__('April')}", "#{__('May')}", "#{__('June')}", "#{__('July')}", "#{__('August')}", "#{__('September')}", "#{__('October')}", "#{__('November')}", "#{__('December')}"];
        var color = Chart.helpers.color;
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [maand[0], maand[1], maand[2], maand[3], maand[4], maand[5], maand[6], maand[7], maand[8], maand[9], maand[10], maand[11]],
                datasets: [{
                    label: "#{__('Exlc. btw')} €",
                    data: [totaal[0], totaal[1], totaal[2], totaal[3], totaal[4], totaal[5], totaal[6], totaal[7], totaal[8], totaal[9], totaal[10], totaal[11]],
                    backgroundColor: color(window.chartColors.red).alpha(1).rgbString(),
                    borderColor: window.chartColors.red,
                    borderWidth: 1
                }, {
                    label: " #{__('Incl. vat')} €",
                    data: [totaal[0] * 1.21, totaal[1] * 1.21, totaal[2] * 1.21, totaal[3] * 1.21, totaal[4] * 1.21, totaal[5] * 1.21, totaal[6] * 1.21, totaal[7] * 1.21, totaal[8] * 1.21, totaal[9] * 1.21, totaal[10] * 1.21, totaal[11] * 1.21],
                    backgroundColor: color(window.chartColors.blue).alpha(1).rgbString(),
                    borderColor: window.chartColors.blue,
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
    }
    function changeBetaald(id, client) {
            window.location = "/change-betaald3/"+id+"/" ;
    }
